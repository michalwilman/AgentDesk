# מדריך התקנה מהיר - OAuth ו-PayPal

## 🎯 סיכום מה שהתווסף

### עמודים חדשים:
1. ✅ עמוד הרשמה משודרג עם Google ו-Facebook OAuth
2. ✅ עמוד תשלום (`/checkout`) עם PayPal אמיתי
3. ✅ עמוד הצלחה (`/checkout/success`)
4. ✅ עמוד ביטול (`/checkout/cancel`)

### בסיס נתונים:
- ✅ טבלת `transactions` חדשה לשמירת פרטי תשלומים

---

## ⚡ התקנה מהירה - 3 שלבים

### שלב 1: הגדרת משתני סביבה

צור קובץ `frontend/.env.local`:

```bash
# Supabase (קיים)
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key

# PayPal Sandbox (חדש)
NEXT_PUBLIC_PAYPAL_CLIENT_ID=your_paypal_client_id
PAYPAL_SECRET=your_paypal_secret
```

### שלב 2: הרצת Schema בבסיס הנתונים

1. עבור ל-Supabase Dashboard
2. לחץ על SQL Editor
3. הרץ את הקוד הבא:

```sql
-- טבלת תשלומים
CREATE TABLE transactions (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  user_id UUID REFERENCES users(id) ON DELETE SET NULL,
  plan VARCHAR(50) NOT NULL,
  amount NUMERIC(10,2) NOT NULL,
  currency VARCHAR(3) DEFAULT 'ILS',
  status VARCHAR(20) NOT NULL DEFAULT 'pending',
  paypal_order_id TEXT,
  full_name VARCHAR(255),
  email VARCHAR(255),
  metadata JSONB DEFAULT '{}',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- אינדקסים
CREATE INDEX idx_transactions_user_id ON transactions(user_id);
CREATE INDEX idx_transactions_status ON transactions(status);
CREATE INDEX idx_transactions_created_at ON transactions(created_at);

-- RLS
ALTER TABLE transactions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own transactions" ON transactions
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can create own transactions" ON transactions
  FOR INSERT WITH CHECK (auth.uid() = user_id);
```

### שלב 3: הפעלת השרת

```bash
cd frontend
npm run dev
```

עכשיו גש ל-`http://localhost:3000/register` ותראה את כפתורי ה-OAuth!

---

## 🔑 הוצאת מפתחות API

### Google OAuth

1. **Google Cloud Console**: https://console.cloud.google.com/
2. צור פרויקט חדש
3. הפעל Google+ API
4. צור OAuth Client ID
5. הוסף Redirect URI: `https://YOUR-PROJECT.supabase.co/auth/v1/callback`
6. העתק Client ID ו-Secret
7. הדבק ב-Supabase → Authentication → Providers → Google

### Facebook OAuth

1. **Facebook Developers**: https://developers.facebook.com/
2. צור אפליקציה חדשה (Consumer)
3. הוסף Facebook Login
4. הוסף Redirect URI: `https://YOUR-PROJECT.supabase.co/auth/v1/callback`
5. העתק App ID ו-Secret
6. הדבק ב-Supabase → Authentication → Providers → Facebook

### PayPal Sandbox

1. **PayPal Developer**: https://developer.paypal.com/
2. עבור ל-Apps & Credentials
3. ודא שאתה במצב **Sandbox** (למעלה)
4. לחץ Create App
5. העתק Client ID ו-Secret
6. הדבק ב-`frontend/.env.local`

---

## 🧪 בדיקת המערכת

### בדיקת OAuth:

```
1. גש ל-http://localhost:3000/register
2. לחץ על "Continue with Google"
3. התחבר עם חשבון Google
4. אמור להיות מועבר חזרה ומחובר ✅
```

### בדיקת PayPal:

```
1. גש ל-http://localhost:3000/pricing
2. לחץ "Get Started" על Pro
3. תועבר לעמוד תשלום
4. לחץ על כפתור PayPal
5. התחבר עם חשבון Sandbox (מ-PayPal Developer)
6. אשר תשלום
7. תועבר לעמוד הצלחה ✅
```

**איפה למצוא חשבון Sandbox?**
- PayPal Developer → Sandbox → Accounts
- השתמש ב-Personal Account לבדיקות

---

## 📂 מבנה הקבצים החדשים

```
frontend/
  ├── app/
  │   ├── (auth)/
  │   │   └── register/
  │   │       └── page.tsx ← עודכן עם OAuth
  │   ├── checkout/
  │   │   ├── page.tsx ← חדש! עמוד תשלום
  │   │   ├── success/
  │   │   │   └── page.tsx ← חדש! עמוד הצלחה
  │   │   └── cancel/
  │   │       └── page.tsx ← חדש! עמוד ביטול
  │   └── pricing/
  │       └── page.tsx ← עודכן עם קישורים חדשים
  └── package.json ← עודכן עם PayPal SDK

supabase/
  └── schema.sql ← טבלת transactions חדשה
```

---

## 🎨 מה שמור על העיצוב

כל העמודים החדשים שומרים על העיצוב של AgentDesk:

- 🎨 רקע כהה: `#0D0D0D`
- 💚 טורקיז: `#00E0C6`
- ✨ אפקטי זוהר (glow)
- 🔄 מעברי אנימציה חלקים
- 📱 רספונסיבי מלא
- 🌐 תמיכה ב-RTL

---

## 🔄 תרשים זרימה

```
עמוד מחירים
    ↓
Pro/Business → /checkout?plan=pro
    ↓
עמוד תשלום (PayPal)
    ↓
תשלום הושלם? 
    ↓           ↓
   כן          לא
    ↓           ↓
נשמר בDB     /cancel
    ↓
/success
```

---

## 🛡️ אבטחה

- ✅ סודות OAuth ב-Supabase (לא בקוד)
- ✅ PayPal Secret שרת בלבד
- ✅ RLS מאובטח
- ✅ Sandbox למבחנים בלבד

---

## 📞 קבלת עזרה

מסמכים מפורטים באנגלית:
- `OAUTH_PAYPAL_SETUP.md` - הדרכה מלאה עם צילומי מסך
- `IMPLEMENTATION_SUMMARY.md` - סיכום טכני מלא

---

## ✅ צ'קליסט סופי

- [ ] הוספת משתני PayPal ל-.env.local
- [ ] הרצת Schema של transactions ב-Supabase
- [ ] הגדרת Google OAuth ב-Supabase
- [ ] הגדרת Facebook OAuth ב-Supabase
- [ ] בדיקת התחברות עם Google
- [ ] בדיקת התחברות עם Facebook
- [ ] בדיקת תשלום PayPal Sandbox
- [ ] וידוא שהתשלום נשמר ב-DB

---

## 🚀 מוכן לעבודה!

**הכל מוכן ומותקן.**  
**רק צריך להגדיר את המפתחות ולהריץ!**

בהצלחה! 💪

